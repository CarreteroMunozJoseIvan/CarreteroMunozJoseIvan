import re

def extract_name_and_layer_aon_gpf(text: str):
    """
    Busca la línea tipo:
      - 'Aon GPF B new ONE NEW ZEALAND GROUP LIMITED - 200m xs 100m - TAL'
      - 'Aon GPF - new Addl - Poste Italiane SpA - PTXIN2502697 - 100m x 50m - ARK - Unipol Cedent'
      - 'Aon GPF - new - Eikos Simah Risk Group 2024 - PTINT2506808 - AIG GPF + ACT - ZAR 2.5bn xs 30m.'
    y devuelve (nombre, layer).
    """

    # 1) Busca una línea que contenga 'Aon GPF' y varios '-'
    line = None
    for ln in text.splitlines():
        if "Aon GPF" in ln and "-" in ln:
            line = ln
            break
    if line is None:
        return None, None

    # 2) Partimos la línea por '-' para reutilizar en todos los planes
    parts = [p.strip() for p in line.split("-") if p.strip()]

    # === PLAN 1: formatos nuevos con nº de póliza PTXXXX... ===
    pol_idx = None
    for i, p in enumerate(parts):
        if re.search(r"\bPT[A-Z0-9]+", p):
            pol_idx = i
            break

    if pol_idx is not None and pol_idx >= 1:
        # nombre = parte anterior a la póliza
        name_raw = parts[pol_idx - 1].strip()

        # layer = primer bloque después de la póliza que contenga "x" o "xs"
        layer_raw = None
        for p in parts[pol_idx + 1:]:
            if re.search(r"\b(?:x|xs)\b", p, flags=re.I):
                layer_raw = p.strip().rstrip(".")
                break

        if name_raw and layer_raw:
            return name_raw, layer_raw
        # si algo falla, caemos al plan antiguo

    # === PLAN 2: formato antiguo '... new NOMBRE - layer - ...' ===
    m = re.search(r"new\s+(.+?)\s*-\s*([^-\n\r]+)\s*-\s*", line, flags=re.I)
    if not m:
        # Plan B: separar por '-' y coger las partes centrales
        if len(parts) >= 3:
            # algo tipo:
            # ['Aon GPF B new ONE NEW ZEALAND GROUP LIMITED', '200m xs 100m', 'TAL']
            name_part = parts[0]
            # saca el nombre quitando el prefijo '... new '
            name_part = re.sub(r"^.*new\s+", "", name_part, flags=re.I)
            name_raw = name_part.strip()
            layer_raw = parts[1].strip()
        else:
            return None, None
    else:
        name_raw = m.group(1).strip()
        layer_raw = m.group(2).strip()

    if not name_raw or not layer_raw:
        return None, None

    return name_raw, layer_raw
