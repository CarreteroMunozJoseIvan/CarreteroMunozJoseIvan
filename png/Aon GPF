import pandas as pd
from pathlib import Path

excel_path = Path(
    r"C:\Users\lmunoz01\OneDrive - Everest Reinsurance\Documents\Aon GPF Automation\Lineslip Tracker 2025_ivan.xlsx"
)
sheet_name = "GPF"

# 1) Leer Excel
df = pd.read_excel(excel_path, sheet_name=sheet_name, header=2)

# 2) Relación Excel → índices pandas
excel_header_row = 3
first_data_row_excel = excel_header_row + 1   # = 4
start_excel_row = 190                         # desde aquí van los nuevos slips

start_idx = start_excel_row - first_data_row_excel  # 190 -> índice 186

# 3) Filtrar solo filas nuevas con Account Name
df_new = df.loc[start_idx:].copy()
df_new = df_new[df_new["Account Name"].notna()]

# 4) Construir GPFxx a partir de Unique Number
def make_gpf(u):
    if pd.isna(u):
        return ""
    # normalmente viene como float (ej. 31.0) → lo pasamos a int
    return f"GPF{int(u)}"

df_new["GPFRef"] = df_new["Unique Number"].apply(make_gpf)

# 5) Construir NameLayer con el formato:
#    Account Name - Layer - [GPFxx]
df_new["NameLayer"] = (
    df_new["Account Name"].astype(str)
    + " - "
    + df_new["Layer"].astype(str)
    + " - ["
    + df_new["GPFRef"].astype(str)
    + "]"
)

# 6) Nos quedamos solo con esa columna
df_name_layer = df_new[["NameLayer"]].reset_index(drop=True)

print(f"Filas generadas: {len(df_name_layer)}")
df_name_layer
