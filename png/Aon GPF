import os
import pandas as pd

# Ruta base de tus cuentas
FINAL_SLIPS_DIR = r"C:\Users\TU_USUARIO\Documents\Final_Slips"  # <- cámbiala

def es_slip(nombre_archivo: str) -> bool:
    """Heurística simple para marcar qué archivo es el slip."""
    n = nombre_archivo.lower()
    if n.startswith("pt"):
        return True
    if " slip" in n or "slip " in n or "declaration" in n:
        return True
    return False

def listar_final_slips(base_dir: str) -> pd.DataFrame:
    registros = []

    # Recorremos SOLO las subcarpetas directas de Final_Slips
    for carpeta in os.listdir(base_dir):
        ruta_carpeta = os.path.join(base_dir, carpeta)
        if not os.path.isdir(ruta_carpeta):
            continue

        for fichero in os.listdir(ruta_carpeta):
            ruta_fichero = os.path.join(ruta_carpeta, fichero)

            if not os.path.isfile(ruta_fichero):
                continue

            ext = os.path.splitext(fichero)[1].lower()

            # Nos quedamos con PDF y Excel (añade más si quieres)
            if ext not in (".pdf", ".xlsx", ".xls"):
                continue

            registros.append({
                "CarpetaCuenta": carpeta,
                "NombreArchivo": fichero,
                "Extension": ext,
                "EsSlip": es_slip(fichero),
                "RutaCompleta": ruta_fichero
            })

    df = pd.DataFrame(registros)
    return df


# Uso:
df_archivos = listar_final_slips(FINAL_SLIPS_DIR)
print(df_archivos)
